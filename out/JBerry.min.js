/*! Made on 28-05-2015 */
var app=angular.module("BerryApp",["ngRoute","ngDragDrop","ui.bootstrap","ui.slider","ui.chart","ui.calendar"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"templates/Main.html",controller:"MainController"}).when("/login",{templateUrl:"templates/LogIn.html",controller:"loginController"}).when("/newblog",{templateUrl:"templates/newBlog.html",controller:"newBlogController"}).when("/blogs",{templateUrl:"templates/blogs.html",controller:"blogController"}).when("/profile",{templateUrl:"templates/profile.html",controller:"profileController"}).when("/checkin",{templateUrl:"templates/checkin.html",controller:"checkinController"}).when("/nutritionopz",{templateUrl:"templates/food/nutritionopz.html",controller:"nutritionopzController"}).when("/recipes/browse",{templateUrl:"templates/recipes/browse.html",controller:"browseController"}).when("/recipes/view/:id",{templateUrl:"templates/recipes/view.html",controller:"browseController"}).when("/messages",{templateUrl:"templates/messages/messages.html",controller:"messagesController"}).when("/trainers",{templateUrl:"templates/trainers.html",controller:"trainersController"}).when("/add",{templateUrl:"templates/recipes/add.html",controller:"addController"})}]),angular.module("ui.chart",[]).directive("uiChart",function(){return{restrict:"EACM",template:"<div></div>",replace:!0,link:function(a,b,c){var d=function(){var d=a.$eval(c.uiChart);if(b.html(""),angular.isArray(d)){var e={};if(!angular.isUndefined(c.chartOptions)&&(e=a.$eval(c.chartOptions),!angular.isObject(e)))throw"Invalid ui.chart options attribute";b.jqplot(d,e)}};a.$watch(c.uiChart,function(){d()},!0),a.$watch(c.chartOptions,function(){d()})}}}),app.controller("MainController",["$scope","$location","userFactory","calendarFactory",function(a,b,c,d){a.templates=[{url:"/templates/home.html",lastPath:"home.html"}],a.isSideBar=!0,a.events=[],a.eventSource={},a.user="",a.calendarConfig={height:$(document).height(),editable:!0,defaultView:"agendaDay",header:{left:"",center:"",right:""}},c.getUser().success(function(d,e,f,g){"Not logged in"===d&&b.path("/login"),a.user=d.local,c.saveUser(d.local)}).error(function(){b.path("/login")}),d.getCalender().success(function(b,c,d,e){if(200===c&&""!==b)for(var f=0;f<b.calenderObj.length;f++)a.events.push(b.calenderObj[f])}).error(function(){console.log("Error")}),a.setTemplate=function(b,c,d){a.templates[0].lastPath!=b&&(a.templates=[{url:"/templates/"+b,lastPath:b}],a.setSelect(d)),void 0!==c&&a.isSideBar!==c&&(a.isSideBar=c)},a.setSelect=function(a){$(".cp-menu li a").removeClass("active"),$(a.currentTarget.children[0]).addClass("active")},a.getTemplate=function(){return name},a.eventSources=[a.events]}]),app.controller("CalendarCtrl",["$scope","$location","calendarFactory",function(a,b,c){a.events=[],a.eventSource={},a.list={Food:[{name:"Sandwich"}],Recipes:[{name:"French Chocolate Cake"}],Activities:[{name:"Cycling"}]},a.calendarConfig={height:.9*$(document).height(),editable:!0,header:{left:"today prev,next",center:"title",right:"month,agendaWeek,agendaDay"},droppable:"*",drop:function(b,c,d,e){a.$apply(function(){a.events.push({title:e.helper[0].innerText,start:b,end:b,className:[e.helper[0].attributes[0].value]})}),a.update()},dayClick:function(b,c,d,e){c&&$(d.target).is(".fc-day")&&a.planner.fullCalendar("changeView","agendaDay").fullCalendar("gotoDate",b.getFullYear(),b.getMonth(),b.getDate())},eventDragStop:function(b,c,d,e){a.update()},eventResizeStop:function(b,c,d,e){a.update()},eventRender:function(b,c){c.bind("dblclick",function(b){for(var c=this.childNodes[0].innerText,d=0;d<a.events.length;d++)if(a.events[d].title===c){a.events.splice(d,1),a.update();break}})}},c.getCalender().success(function(b,c,d,e){if(200===c&&""!==b)for(var f=0;f<b.calenderObj.length;f++)a.events.push({title:b.calenderObj[f].title,start:b.calenderObj[f].start,end:b.calenderObj[f].end,className:b.calenderObj[f].className})}).error(function(){console.log("Error")}),a.update=function(){c.setCalender(a.events)},a.listRemove=function(b,c){a.list[c].splice(b,1)},a.getWidth=function(){return $(document).width()-.1666666667*$(document).width()*2},angular.element(document).ready(function(){setTimeout(function(){$("#calender").fullCalendar("refresh")},2e3)}),a.claendarWraper={width:a.getWidth()},a.eventSources=[a.events]}]),app.controller("addCtrl",["$scope","$location",function(a,b){a.ingredients=[],a.addIngredient=function(){""!==a.name&&""!==a.amount&&""!==a.type&&(a.ingredients.push({name:a.name,amount:a.amount,type:a.type}),a.name="",a.amount="",a.type="")},a.removeIngredient=function(b){a.ingredients.splice(b,1)},a.updateTypeHead=function(){return""===a.selected?void(a.food={}):void foodFactory.getFoodByName(a.selected).success(function(b,c,d,e){200===c&&(a.food=b)}).error(function(){console.log("Error")})}}]),app.controller("blogController",["$scope","$location","$http","blogFactory",function(a,b,c,d){a.blogs="",d.getBlogs().success(function(b,c,d,e){200===c&&(console.log(c),console.log(b),a.blogs=b)}).error(function(){console.log("Error")}),a.favsCounter=function(a){var b={id:a};console.log("data in favsCount: "+b),d.addFavs(b).success(function(a,b,c,d){console.log(b)}).error(function(){console.log("Error")})},a.addComment=function(a,b){var c={id:a,comment:b};console.log("data in comment: "+c.comment),d.addComments(c).success(function(a,b,c,d){console.log(b)}).error(function(){console.log("Error")})}}]),app.controller("bodymeasurementsController",["$scope","$location",function(a,b){}]),app.controller("checkinController",["$scope","$location",function(a,b){}]),app.controller("foodController",["$scope","$location","$http","foodFactory",function(a,b,c,d){a.foodItem="Empty",a.recipeItem="Empty",d.getFoodByName("SKYR").success(function(b,c,d,e){200===c&&(console.log(b),a.foodItem=b)}).error(function(){console.log("Error")})}]),app.controller("loginController",["$scope","$location","$http","userFactory",function(a,b,c,d){a.reg={name:"",email:"",password:"",conpassword:""},a.errorMsg="",a.email="",a.pass="",a.connect=function(){(a.email||a.pass)&&d.validUser(a.email,a.pass).success(function(c,d,e,f){200===d&&("Failed to authenticate"===c?a.errorMsg=c:"Successfully authenticated"===c&&b.path("/")),a.email="",a.pass=""}).error(function(){a.errorMsg="Failed to authenticate",a.email="",a.pass=""})},a.register=function(){a.reg&&d.setUser(a.reg).success(function(a,c,d,e){200===c&&b.path("/")}).error(function(){console.log("Error")})}}]),app.controller("measurementsController",["$scope","$location",function(a,b){}]),app.controller("messagesController",["$scope","$location","$http","messagesFactory",function(a,b,c,d){console.log("controller"),a.tabs=[{name:"New message",url:"templates/messages/write.html"},{name:"Inbox",url:"templates/messages/inbox.html",active:!0},{name:"Sent",url:"templates/messages/sent.html"},{name:"Trash",url:"templates/messages/trash.html"}],a.message={recID:"",title:"",message:""},a.setRec=function(b){a.message.recID=b._id,a.message.senName=b.local.name},d.getUsers().success(function(b,c,d,e){200==c&&(a.users=b)}).error(function(){a.users.local.name="Error"}),d.getMessages().success(function(b,c,d,e){200==c&&(a.messages=b)}).error(function(){a.messages="Error"}),a.sendMessage=function(){console.log("controller sendMessage"),console.log(a.message.recID),""!==a.message.recID&&""!==a.message.title&&""!==a.message.message&&d.sendMessage(a.message)}}]),app.controller("metabolicController",["$scope","$location",function(a,b){}]),app.controller("newBlogController",["$scope","$location","$http","blogFactory",function(a,b,c,d){a.newBlog={title:"",body:"",tags:""},a.AddBlog=function(){if(a.newBlog.title||a.newBlog.body){var c=a.newBlog.tags.split(" "),e={title:a.newBlog.title,body:a.newBlog.body,tags:c};console.log(e),d.postBlog(e).success(function(c,d,e,f){console.log(d),200===d&&(b.path("/blogs"),a.$apply())}).error(function(){console.log("Error")})}}}]),app.controller("addCtrl",["$scope","$location","foodFactory",function(a,b,c){a.ingredients=[],a.foods={},a.name="",a.addIngredient=function(){""!==a.name&&""!==a.amount&&""!==a.type&&(a.ingredients.push({name:a.name,amount:a.amount,type:a.type}),a.name="",a.amount="",a.type="")},a.removeIngredient=function(b){a.ingredients.splice(b,1)},a.updateTypeHead=function(){return""===a.name?void(a.foods={}):void c.getFoodByName(a.name).success(function(b,c,d,e){200===c&&(a.foods=b)}).error(function(){console.log("Error")})}}]),app.controller("profileController",["$scope","$location","$http","profileFactory","userFactory",function(a,b,c,d,e){console.log("in controller"),a.profile={user:"",firstName:"",lastName:"",email:"",height:"",weight:"",birthday:""},a.posts="",a.timeline="",a.post=function(){var b=a.timeline;console.log(b),d.pushPost(b).success(function(a,b,c,d){console.log(b)}).error(function(){console.log("error posting")})},d.getProfile().then(function(c){200==c[0].status&&200==c[1].status?(a.profile=c[0].data,a.posts=c[1].data,console.log(a.posts)):b.path("/login")}),a.changeInfo=function(){var c=a.profile;console.log(c.firstName),d.changeProfile(c).success(function(a,c,d,e){console.log(c),b.path("/")}).error(function(){console.log("Error")})},a.trainer=function(){d.ImTrainer().then(function(){console.log("controller trainer")})},a.favsCounter=function(a){var b={id:a};console.log("data in favsCount: "+b),d.addFavs(b).success(function(a,b,c,d){console.log(b)}).error(function(){console.log("Error")})},a.addComment=function(a,b){var c={id:a,comment:b};console.log("data in comment: "+c.comment),d.addComments(c).success(function(a,b,c,d){console.log(b)}).error(function(){console.log("Error")})}}]),app.controller("addController",["$scope","$location","foodFactory",function(a,b,c){a.recipe={title:"",steps:[],ingredients:[],tags:[]},a.addIngredient=function(){a.recipe.ingredients.push()},a.addRecipe=function(){""!==a.recipe.title&&c.postRecipe(recipe).success(function(a,b,c){console.log(b)})}}]),app.controller("browseController",["$scope","$location","foodFactory",function(a,b,c){a.selected=void 0,a.$item=void 0,a.$model=void 0,a.$label=void 0,a.option={A:10,B:15,C:20,D:[5.5,30]},a.optionD={min:200,max:700},a.onSelect=function(b,c,d){a.updateTypeHead()},a.getName=function(b){var c=b.split(", ");return a.toTitle(c[0])},a.getSubName=function(b){if(b.indexOf(", ")<=-1)return"";for(var c=b.split(", "),d=c[1],e=2;e<c.length;e++)d+="/"+c[e];return a.toTitle(d)},a.toTitle=function(a){return a.toLowerCase().charAt(0).toUpperCase()+a.slice(1)},a.getType=function(b){var c=parseInt(b,10);return isNaN(c)&&a.getTypeByName(b),4>c?"block-blue":4===c||5===c?"block-yellow":6===c||7===c?"block-green":8===c||9===c?"block-red":c>10&&13>c?"block-white":16===c||13===c?"block-orange":14===c?"block-lightBlue":15===c?"block-gray":17===c?"block-redBrown":18===c?"block-pink":19===c?"block-brown":"block-defult"},a.getTypeByName=function(a){console.log(a)},a.checkName=function(a){return void 0!==a&&null!==a?a:"-"},a.updateTypeHead=function(){return""===a.selected?void(a.food={}):void c.getFoodByName(a.selected).success(function(b,c,d,e){200===c&&(a.food=b)}).error(function(){console.log("Error")})},a.showRecipe=function(b){c.getRecipeById(b).success(function(c,d,e,f){200===d&&(a.recipeItem=c,console.log(b),console.log(c))}).error(function(){console.log("Error")})}}]),app.controller("skinfoldController",["$scope","$location",function(a,b){}]),app.controller("statisticController",["$scope","$location",function(a,b){a.dataStorage={data1:[[3,7,9,1,4,6,8,2,5]],data2:[[8,7,2,1,3,4,6,8,5]],data3:[[9,8,7,6,5,4,3,2,1]],data4:[[3,7,9,1,4,6,8,2,5]],data5:[[8,8,8,8,0,8,8,8,8]],data6:[[9,0,9,0,9,0,9,0,9]]},a.plots={data1:null,data2:null,data3:null,data4:null,data5:null,data6:null},a.options={title:"This",grid:{background:"rgb(245, 245, 245)"}},a.repaint=function(b){var c,d,e=$("."+b);setTimeout(function(){$(e).each(function(){c=$(this).attr("ui-chart").split(".")[1],null===a.plots[c]&&(a.plots[c]=$.jqplot(this.id,a.dataStorage[c],a.options)),0===a.plots[c]._drawCount&&d.replot()})},10)},a.destroy=function(b){var c,d,e=$("."+b);$(e).each(function(){c=$(this).attr("ui-chart").split(".")[1],d=$.jqplot(this.id,a.dataStorage[c]),d.destroy()})},angular.element(document).ready(function(){setTimeout(function(){a.destroy("plotNutrients"),a.repaint("plotNutrients")},1e3)})}]),app.controller("trainersController",["$scope","$location","trainersFactory",function(a,b,c){a.trainers="",c.getTrainers().success(function(b,c,d,e){200===c&&(a.trainers=b)})}]),angular.module("ui.calendar",[]).constant("uiCalendarConfig",{}).controller("uiCalendarCtrl",["$scope","$timeout",function(a,b){var c=1,d=1,e=a.eventSources,f=a.calendarWatchEvent?a.calendarWatchEvent:angular.noop,g=function(a){var c;return a&&(c=function(){var c=arguments;b(function(){a.apply(this,c)})}),c};this.eventsFingerprint=function(a){return a.__uiCalId||(a.__uiCalId=d++),""+a.__uiCalId+(a.id||"")+(a.title||"")+(a.url||"")+(+a.start||"")+(+a.end||"")+(a.allDay||"")+(a.className||"")+f(a)||""},this.sourcesFingerprint=function(a){return a.__id||(a.__id=c++)},this.allEvents=function(){for(var a=[],b=0,c=e.length;c>b;b++){var d=e[b];if(angular.isArray(d))a.push(d);else if(angular.isObject(d)&&angular.isArray(d.events)){var f={};for(var g in d)"_uiCalId"!==g&&"events"!==g&&(f[g]=d[g]);for(var h=0;h<d.events.length;h++)angular.extend(d.events[h],f);a.push(d.events)}}return Array.prototype.concat.apply([],a)},this.changeWatcher=function(a,b){var c,d=function(){for(var c,d,e=angular.isFunction(a)?a():a,g=[],h=0,i=e.length;i>h;h++)d=e[h],c=b(d),f[c]=d,g.push(c);return g},e=function(a,b){var c,d,e=[],f={};for(c=0,d=b.length;d>c;c++)f[b[c]]=!0;for(c=0,d=a.length;d>c;c++)f[a[c]]||e.push(a[c]);return e},f={},g=function(a,d){var g,h,i,j,k={},l=e(d,a);for(g=0,h=l.length;h>g;g++){var m=l[g];i=f[m],delete f[m];var n=b(i);n===m?c.onRemoved(i):(k[n]=m,c.onChanged(i))}var o=e(a,d);for(g=0,h=o.length;h>g;g++)j=o[g],i=f[j],k[j]||c.onAdded(i)};return c={subscribe:function(a,b){a.$watch(d,function(a,c){b&&b(a,c)===!1||g(a,c)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}},this.getFullCalendarConfig=function(a,b){var c={};return angular.extend(c,b),angular.extend(c,a),angular.forEach(c,function(a,b){"function"==typeof a&&(c[b]=g(c[b]))}),c}}]).directive("uiCalendar",["uiCalendarConfig","$locale",function(a,b){var c=function(a){var b,c;b=[];for(c in a)b[c]=a[c];return b},d=b.DATETIME_FORMATS;return a=angular.extend({monthNames:c(d.MONTH),monthNamesShort:c(d.SHORTMONTH),dayNames:c(d.DAY),dayNamesShort:c(d.SHORTDAY)},a||{}),{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(b,c,d,e){function f(){var c,f=d.uiCalendar?b.$parent.$eval(d.uiCalendar):{};c=e.getFullCalendarConfig(f,a),k={eventSources:g},angular.extend(k,c);var h={};for(var i in k)"eventSources"!==i&&(h[i]=k[i]);return JSON.stringify(h)}var g=b.eventSources,h=!1,i=e.changeWatcher(g,e.sourcesFingerprint),j=e.changeWatcher(e.allEvents,e.eventsFingerprint),k=null;b.destroy=function(){d.calendar?b.calendar=b.$parent[d.calendar]=c.html(""):b.calendar=c.html("")},b.init=function(){b.calendar.fullCalendar(k)},i.onAdded=function(a){b.calendar.fullCalendar("addEventSource",a),h=!0},i.onRemoved=function(a){b.calendar.fullCalendar("removeEventSource",a),h=!0},j.onAdded=function(a){b.calendar.fullCalendar("renderEvent",a)},j.onRemoved=function(a){b.calendar.fullCalendar("removeEvents",function(b){return b===a})},j.onChanged=function(a){b.calendar.fullCalendar("updateEvent",a)},i.subscribe(b),j.subscribe(b,function(a,b){return h===!0?(h=!1,!1):void 0}),b.$watch(f,function(a,c){b.destroy(),b.init()})}}}]),app.directive("checker",["$compile",function(a){return{restrict:"A",link:function(a,b,c){function d(){var a=h.is(":checked");k=a?"on":"off",g.find(".state-icon").removeClass().addClass("state-icon "+j[k]),a?g.removeClass("btn-default").addClass("btn-"+i+" active"):g.removeClass("btn-"+i+" active").addClass("btn-default")}function e(a){g=a.find("button"),h=a.find("input:checkbox"),i=g.data("color"),j={on:"glyphicon glyphicon-check",off:"glyphicon glyphicon-unchecked"}}function f(){d(),0===g.find(".state-icon").length&&g.prepend('<i class="state-icon '+j[k]+'"></i> ')}var g,h,i,j,k;e(b),g.on("click",function(){h.prop("checked",!h.is(":checked")),h.triggerHandler("change"),d()}),h.on("change",function(){d()}),f()}}}]),app.directive("timeLine",["$compile",function(a){function b(a){for(var b,f="<p id='timer'>"+a.hour+":"+c(a.minute)+":"+c(a.secounds)+"</p><ul id='timeline'>",g=["workout","eat","alarm"],i=0;24>i;i++)b=g[Math.floor(2*Math.random())],f+="<li class ='"+b+" '>",f+="<input class='checkradio' id='work"+i+"' name='works' type='radio' checked=''>",f+=d(i),f+=e(h),f+="</li>";return f+="</ul>"}function c(a){return 10>a?"0"+a:a}function d(a){var b="";return b+="<div class='relative'>",b+="<label for='work"+a+"'>Lorem ipsum</label>",b+="<span class='circle'></span>",b+="</div>"}function e(a){var b="";return b+="<div class='content'>",b+="<p>",b+=a,b+="</p>",b+="</div>"}function f(a){var b,d,e,f;g=setInterval(function(){b=new Date,d=b.getHours(),e=c(b.getMinutes()),f=c(b.getSeconds()),a.firstChild.innerHTML=d+":"+e+":"+f},1e3)}var g,h="Lorem ipsum dolor sit amet, consectetur adipisicing elit.";return{restrict:"E",replace:"true",link:function(c,d,e){var h=new Date,i=h.getHours(),j=h.getMinutes(),k=h.getSeconds();d.html(b({hour:i,minute:j,secounds:k,period:i>12?"PM":"AM"})),a(d.contents()),d.bind("$destroy",function(){clearInterval(g)}),f(d[0])}}}]),app.factory("blogFactory",["$location","$http","$q",function(a,b,c){return{postBlog:function(a){return b.post("http://localhost:3000/api/blog",{title:a.title,body:a.body,tags:a.tags})},getBlogs:function(){return b.get("http://localhost:3000/api/blog")},addFavs:function(a){return console.log("id: "+a.id),b.put("http://localhost:3000/api/blog/meta/favs",{_id:a.id})},addComments:function(a){return console.log("dataFactory: "+a.comment),b.put("http://localhost:3000/api/blog/comment",{_id:a.id,comment:a.comment})}}}]),app.factory("calendarFactory",["$location","$http",function(a,b){return{setCalender:function(a){b({method:"post",url:"http://localhost:3000/api/calender",data:{calender:a}})},getCalender:function(){return b.get("http://localhost:3000/api/calender")}}}]),app.factory("foodFactory",["$location","$http","$q",function(a,b,c){return{getFoodByName:function(a){return b.get("http://localhost:3000/api/food/getByName/"+a)},getRecipeById:function(a){return b.post("http://localhost:3000/api/recipe/get",{id:a})},postRecipe:function(a){return b.post("http://localhost:3000/api/recipe",{title:a.title,steps:a.steps,ingredients:a.ingredients,tags:a.tags})}}}]),app.factory("messagesFactory",["$location","$http","$q",function(a,b,c){return{sendMessage:function(a){return b.post("http://localhost:3000/api/messages",{title:a.title,message:a.message,recID:a.recID})},getMessages:function(){return b.get("http://localhost:3000/api/messages")},getUsers:function(){return b.get("http://localhost:3000/api/userpublicinfo")}}}]),app.factory("profileFactory",["$location","$http","$q",function(a,b,c){return{addFavs:function(a){return console.log("id: "+a.id),b.put("http://localhost:3000/api/blog/meta/favs",{_id:a.id})},addComments:function(a){return console.log("dataFactory: "+a.comment),b.put("http://localhost:3000/api/blog/comment",{_id:a.id,comment:a.comment})},getProfile:function(){return c.all([b.get("http://localhost:3000/api/profile"),b.get("http://localhost:3000/api/blog")])},changeProfile:function(a){return b.put("http://localhost:3000/api/profile/update",{firstName:a.firstName,lastName:a.lastName,height:a.height,weight:a.weight,email:a.email,birthday:a.birthday})},pushPost:function(a){return b.post("http://localhost:3000/api/blog",{title:a.title,body:a.body,tags:a.tags})},ImTrainer:function(){return b.put("http://localhost:3000/api/settrainer")}}}]),app.factory("trainersFactory",["$location","$http","$q",function(a,b,c){return{getTrainers:function(a){return b.get("http://localhost:3000/api/trainers")}}}]),app.factory("userFactory",["$location","$http","$q",function(a,b,c){var d;return{validUser:function(a,c){return b.post("http://localhost:3000/api/login",{email:a,password:c})},getToken:function(){return d.Token},getUser:function(){return b.get("http://localhost:3000/api/userinfo")},setUser:function(a){return b.post("http://localhost:3000/api/register",{name:a.name,email:a.email,password:a.password})},saveUser:function(a){d=a},getUserName:function(){return d.name}}}]);